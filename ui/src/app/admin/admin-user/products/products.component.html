<div class="admin-products">
  <div class="row">
    <!--PRODUCTS TABLE-->
    <div class="col-12">
      <div class="row">
        <div class="col-8">
          <h2>Productos</h2>
        </div>
      </div>
      <div style="overflow-x:auto;">
        <table class="table table-striped" *ngIf="!alerts.products.loading">
          <thead>
          <tr>
            <th scope="col">Id</th>
            <th scope="col">Nombre</th>
            <th scope="col">Imagen</th>
            <th scope="col">Descripcion</th>
            <th scope="col">Ultima Modificación</th>
            <th scope="col">Reportador</th>
            <th scope="col">Creación</th>
            <th scope="col">Validar</th>
            <th scope="col">Eliminar</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let product of (productsArray | paginate: { itemsPerPage: 10, currentPage: productsPage, id: 'products' }); let i=index">
            <td>{{product.id}}</td>
            <td>{{product.name}}</td>
            <td class="product-image"><img class="product-img" [src]="product.imageUrl" alt="Product Image"></td>
            <td style="text-align: left">{{product.description | truncate: 100}}</td>
            <td><span *ngIf="product.updateDate">{{product.updateDate.toStringDate()}}</span><span *ngIf="!product.updateDate">Nunca</span></td>
            <td><span class="user-name" (click)="openRequesterModal(userDetailModal,'User', users.get(product.userId))">{{users.get(product.userId).name}}</span></td>
            <td>{{product.uploadDate.toStringDate()}}</td>
            <td>
              <div class="upload-button">
                <button type="button" class="btn btn-light" *ngIf="!product.isValidated" (click)="openProductModal(validateProduct, product)">
                  <i class="fa fa-check"></i>
                </button>
                <span *ngIf="product.isValidated">Validado</span>
              </div>
            </td>
            <td>
              <div class="remove-button">
                <button type="submit" class="btn btn-danger" (click)="openProductDeleteModal(deleteModal, product, i)">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
      <pagination-controls id="products"
                           class="paginator"
                           (pageChange)="productsPage = $event"
                           autoHide="true"
                           previousLabel="Anterior"
                           nextLabel="Siguiente">
      </pagination-controls>
    </div>

    <!--validate Product Modal-->
    <ng-template #validateProduct>
      <div class="modal-header">
        <h4 class="modal-title pull-left">
          <span *ngIf="newProduct.id">Validar producto {{newProduct.name}}</span>
        </h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ¿Está seguro que desea validar el producto?
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary" (click)="validateProductA()">Confirmar</button>
      </div>
    </ng-template>

    <!--Delete confirmation modal-->
    <ng-template #deleteModal>
      <div class="modal-header" (keyup.esc)="resetDeleteModal()">
        <h4 class="modal-title pull-left">Eliminar
          <span *ngIf="productToDelete">Producto {{productToDelete.name}}</span>
        </h4>
        <button type="button" class="close pull-right" aria-label="Close" (click)="resetDeleteModal(); modalRef.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ¿Está seguro que desea eliminar el producto?
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-danger" (click)="this.deleteProduct()">Eliminar</button>
        <button type="submit" class="btn btn-secondary" (click)="resetDeleteModal(); modalRef.hide();">Cancelar</button>
      </div>
    </ng-template>

    <!--DETAIL USER MODAL-->
    <ng-template #userDetailModal>
      <div class="modal-header" (keyup.esc)="resetUserModal()">
        <h4 class="modal-title pull-left">
          <span *ngIf="selectedUser.id">Detalles del Usuario: {{selectedUser.name}}</span>
        </h4>

        <button type="button" class="close pull-right" aria-label="Close" (click)="resetUserModal()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div style="width: 100%">
            <ul class="list-group list-group-flush" *ngIf="selectedUser.id">
              <li class="list-group-item"><b>ID: </b><span>{{selectedUser.id}}</span></li>
              <li class="list-group-item"><b>Nombre: </b><span>{{selectedUser.name}}</span></li>
              <li class="list-group-item"><b>Apellido: </b><span>{{selectedUser.lastName}}</span></li>
              <li class="list-group-item"><b>Usuario: </b><span>{{selectedUser.username}}</span></li>
              <li class="list-group-item"><b>Email: </b><span>{{selectedUser.email}}</span></li>
              <li class="list-group-item"><b>Rating: </b><span>{{selectedUser.rate}}</span></li>
              <li class="list-group-item"><b>Porcentaje de reportes aprobados: </b><span>{{selectedUser.acceptedReportsPercentage}}%</span></li>
            </ul>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-secondary" (click)="resetUserModal()">Volver</button>
      </div>
    </ng-template>

  </div>
</div>
